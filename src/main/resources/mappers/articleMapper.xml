<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.fit.model.dao.IArticleDao">

    <!-- 게시글 전체 조회 -->
    <select id="selectArticleAll" resultType="Article">
        SELECT *,
        (select count(*) from likeArticle where articleNo = atc.articleNo) as likeCnt
         FROM article as atc
    </select>

    <!-- 나의 게시글 조회 -->
    <select id="selectMyArticle" parameterType="int" resultType="Article">
        SELECT *,
        	(select count(*) from likeArticle where articleNo = atc.articleNo) as likeCnt
         FROM article as atc
         WHERE userNo = #{userNo}
    </select>

    <!-- 게시글 상세 조회 -->
    <select id="selectArticleByNo" parameterType="int" resultType="Article">
        SELECT *,
        (select count(*) from likeArticle where articleNo = atc.articleNo) as likeCnt
         FROM Article as atc
         WHERE articleNo = #{articleNo}
    </select>
    
    <!-- 게시글 작성 -->
    <insert id="insertArticle" parameterType="Article">
        INSERT INTO article (userNo, content, imgfullpath, imgName, created_at, updated_at, likecnt, viewcnt)
        VALUES (#{userNo}, #{content}, #{imgFullpath}, #{imgName}, now(), now(), 0, 0);
    </insert>
    
    <!-- 게시글 수정 -->
    <update id="updateArticle" parameterType="map">
        UPDATE article
        SET content = #{content}, imgFullpath = #{imgFullpath}, imgName = #{imgName}, updated_at = now()
        WHERE reviewNo = #{reviewNo};
    </update>
    
    <!-- 게시글 삭제 -->
    <delete id="deleteArticle" parameterType="int">
        DELETE FROM article WHERE articleNo = #{articleNo};
    </delete>
    
    <!-- 게시글 조회수 증가 -->
    <update id="increaseViewCnt" parameterType="int">
        UPDATE article
        SET viewCnt = viewCnt+1
        WHERE articleNo = #{articleNo};
    </update>
    
    <!-- 게시글 좋아요 -->
    <insert id="articleLike" parameterType="map">
        INSERT INTO likeArticle (articleNo, userNo)
        VALUES(#{articleNo}, #{userNo})
    </insert>
    
<!--     게시글 좋아요취소
    <insert id="articleLike" parameterType="map">
        INSERT INTO likeArticle (articleNo, userNo)
        VALUES(#{articleNo}, #{userNo})
    </insert> -->
    
    
    
    

</mapper>